# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Описание проекта

Проект написан с использованием архитектуры MVP

- Model (Модель):
  Это слой, который содержит бизнес-логику приложения и данные. Модель предоставляет методы для работы с данными и управляет их состоянием.

Основные классы модели:`Model`,`EventEmitter`

- View (Представление)
  Это слой, который отвечает за отображение данных пользователю и получение от него входных данных.

Основной класс представления: `Component`

- Presenter (Презентер):
  Это слой, который служит посредником между моделью и представлением. Презентер получает данные из модели, обрабатывает их и передает в представление для отображения. Он также принимает пользовательский ввод от представления, обрабатывает его и передает соответствующие команды модели.

Основной класс презентера:`Api`

# _Описание данных_

# Базовый код

### _Model_ <T>

`Model<T>` Является базовым классом представляющим модель данных. Используется для отличия от простых объектов с данными и обеспечивает функционал events - уведомления об изменениях.
Класс является дженериком и принимает тип данных <T> представляющий структуру данных модели

Конструктор принимает следующие параметры:

- `data: Partial<T>` - Данные модели.
- `events: IEvents` - Объект для управления событиями.

Включает метод: emitChanges

```
     Сообщает всем подписчикам об изменении модели.
    emitChanges(event: string, payload?: object): void;
```

Дочерние классы: `AppState`, `ProductItem`

### EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Конструктор класса EventEmitter инициализирует объект класса. В частности, он создает пустую карту `_events: Map<EventName, Set<Subscriber>>`, которая будет использоваться для хранения событий и их обработчиков.

Включает методы:

```
     * Устанавливает подписку для указанного события.
    on

     * Удаляет подписку для указанного события.
    off

     * Инициирует событие с указанными данными.
    emit

     * Подписывается на все события.
    onAll

     * Отменяет все подписки на события.
    offAll

     * Создает триггер, генерирующий событие с указанным названием при вызове.
    trigger

```

### Component

`Component<T>` Является базовым классом для работы с DOM элементами и родителем для всех компонентов представления.
Предоставляет методы для управления отображением, классами, текстом и состоянием DOM элементов.
Класс является дженериком и принимает тип данных <T> для отрисовки компонента.

Конструктор принимает следующие параметры:

```
container: HTMLElement - Контейнер, в котором будет отображаться компонент.
```

И включает методы:

```
    * Переключает указанный класс у элемента.
    toggleClass

    * Устанавливает текстовое содержимое указанного элемента.
    setText

    * Устанавливает состояние блокировки указанного элемента.
    setDisabled

    * Скрывает указанный элемент.
    setHidden

    * Показывает указанный элемент.
    setVisible(element: HTMLElement)

    * Устанавливает изображение с альтернативным текстом для указанного элемента.
    setImage

   * Рендерит компонент и возвращает его корневой DOM элемент.
    render
```

Дочерние классы: `Basket`, `Modal`, `Form`, `Success`, `Card`, `Page`

### Api

- Класс для выполнения HTTP-запросов к API.
- Предоставляет методы для отправки GET и POST запросов.

Конструктор принимает следующие параметры:

- `baseUrl: string` - Базовый URL API.
- `options: RequestInit` - Настройки запроса по умолчанию.

И включает методы:

```
     * Обрабатывает ответ от сервера.
handleResponse(response: Response): Promise<object>;

     * Выполняет GET запрос к API.
    get(uri: string): Promise<object>;

     * Выполняет POST запрос к API.
    post(uri: string, data: object, method?: ApiPostMethods): Promise<object>;

```

Дочерние классы: ShopAPI

# Дополнительные Модели данных (Бизнес-логика)

### AppState

- Класс для управления состоянием приложения.
- Расширяет базовую модель `Model` и предоставляет методы для работы с корзиной, каталогом, заказом и предпросмотром товаров,
- а также для валидации данных заказа и контактной информации.

Класс содержит четыре свойства: `basket`, `catalog`, `loading` и `order`, которые хранят информацию о состоянии корзины, каталога товаров, состоянии загрузки данных и заказе пользователя соответственно.

Класс также содержит два дополнительных свойства: `preview`, хранящее ссылку на изображение предпросмотра, и `formErrors`, хранящее информацию об ошибках формы.

И включает методы:

```
    * Очищает информацию о заказе и уведомляет об изменениях.
   clearOrder(): void;

    * Очищает корзину и уведомляет об изменениях.
   clearBasket(): void;

    * Добавляет элемент в корзину и обновляет состояние.
   addToBasket(item: ProductItem): void;

    * Обновляет состояние корзины.
   updateBasket(): void;

    * Удаляет элемент из корзины и обновляет состояние.
   removeFromBasket(item: ProductItem): void;

    * Проверяет, содержится ли указанный элемент в корзине.
   isInBasket(item: ProductItem): boolean;

    * Устанавливает элементы каталога и уведомляет об изменениях.
   setCatalog(items: IProductItem[]): void;

    * Устанавливает предпросматриваемый товар.
   setPreview(item: ProductItem): void;

    * Устанавливает значение поля заказа и проверяет его валидность.
   setOrderField(field: keyof IOrderForm, value: string): void;

    * Устанавливает значение поля контактной информации и проверяет его валидность.
   setContactsField(field: keyof IOrderForm, value: string): void;

    * Устанавливает общую стоимость заказа.
   setTotal(total: number): void;

    * Устанавливает элементы заказа.
   setItems(items: string[]): void;

    * Устанавливает способ оплаты.
   setPayment(value: string): void;

    * Проверяет валидность контактной информации.
   validateContacts(): boolean;

    * Проверяет валидность данных заказа.
   validateOrder(): boolean;


```

### ProductItem

- Класс, представляющий объект продукта.
- Расширяет базовую модель `Model<IProductItem>`.
- Реализует интерфейс `IProductItem`

## Компоненты представления

### Modal

- Компонент для отображения модального окна.
- Расширяет базовый класс `Component` и принимает данные типа `IModalData`.

```
interface IModalData {
	content: HTMLElement;
}
```

Класс содержит два защищенных свойства
`_closeButton` и `_content`, которые хранят в себе элементы кнопки для закрытия модального окна и контент модального окна соответственно.

Включает методы:

```
     * Открывает модальное окно.
    open(): void;

     * Закрывает модальное окно.
    close(): void;

     * Создает DOM-элемент модального окна с учетом переданных данных.
    render(data: IModalData): HTMLElement;

```

И Сеттер:

```
     * Устанавливает контент модального окна.
    set content(value: HTMLElement): void;
```

### Form <T>

- Компонент для отображения формы.
- Расширяет базовый класс `Component` и принимает данные типа `IFormState`.

дженерик T используется для определения типа данных формы. Это позволяет создавать экземпляры класса Form, работающие с разными типами данных, в зависимости от конкретного использования.

Класс содержит два защищенных свойства
`_submit` и `_errors`, которые хранят в себе элементы кнопки для отправки формы и отображения ошибок формы;

Включает методы:

```
     * Обрабатывает событие изменения ввода.
 onInputChange

     * Создает DOM-элемент формы с учетом переданного состояния.
    render

```

И сеттеры:

```
     * Устанавливает состояние валидности формы.
    set valid(value: boolean): void;

     * Устанавливает текст ошибок формы.
    set errors(value: string): void;
```

### Success

- Компонент для отображения сообщения об успешном оформлении заказа.
- Расширяет базовый класс `Component` и принимает данные типа `ISuccess`.

```
interface ISuccess {
	total: number;
}
```

Cодержит защищенное свойство
`_close`, которое хранит в себе элемент кнопки для закрытия сообщения об успешном действии.

### Basket

- Компонент для отображения корзины.
- Расширяет базовый класс `Component` и принимает данные типа `IBasketView`.

Содержит защищенные свойства `_list` `_total` и `_button`
которые хранят в себе элементы списка элементов корзины,общую стоисость товаров в корзине и элемент кнопки для оформления заказа соответственно.

Включает метод:

```
    * Управляет доступностью кнопки для оформления заказа.
   buttonIsDisabled(isDisabled: boolean): void;
}
```

и сеттеры:

```
    * Устанавливает список элементов корзины.
   set items(items: HTMLElement[]): void;

    * Устанавливает общую стоимость товаров в корзине.
   set total(total: number): void;
```

### Card

- Компонент для отображения карточки товара.
- Расширяет базовый класс `Component` и принимает данные типа `ICard`.

Свойства:

```
    * Заголовок карточки.
   protected _title: HTMLElement;

    * Изображение товара.
   protected _image?: HTMLImageElement;

    * Описание товара.
   protected _description?: HTMLElement;

    * Кнопка для действия с товаром.
   protected _button?: HTMLButtonElement;

    * Цена товара.
   protected _price: HTMLElement;

    * Категория товара.
   protected _category?: HTMLElement;

    * Индекс товара.
   protected _index?: HTMLElement;

    * Название кнопки.
   protected _buttonTitle: string;
}

```

Сеттеры:

```
* Устанавливает идентификатор товара.
   set id(value: string): void;

    * Устанавливает заголовок карточки.
   set title(value: string): void;

    * Устанавливает изображение товара.
   set image(value: string): void;

    * Устанавливает описание товара.
   set description(value: string | string[]): void;

    * Устанавливает цену товара.
   set price(value: number | null): void;

    * Устанавливает категорию товара.
   set category(value: string): void;

    * Устанавливает индекс товара.
   set index(value: string): void;

       * Устанавливает название кнопки.
   set buttonTitle(value: string): void;

```

Геттеры:

```
* Получает идентификатор товара.
   get id(): string;

 * Получает заголовок карточки.
   get title(): string;

* Получает цену товара.
   get price(): number;

    * Получает категорию товара.
   get category(): string;

    * Получает индекс товара.
   get index(): string;

```

Дочерний класс: `CardItem`

- Создает новый экземпляр элемента карточки.

```
 constructor(container: HTMLElement, actions?: ICardActions)

     container: HTMLElement - HTML-элемент, в котором содержится карточка.
     actions?: ICardActions -  Действия, связанные с карточкой.

        super('card', container, actions);
    Вызов конструктора базового класса Card с указанием блока 'card'.
```

### Order

- Компонент для оформления заказа.
- Расширяет базовый класс `Form` и принимает данные типа `IOrderForm`.

Содержит два защищенных свойства `_paymentCard` `_paymentCash`, которые хранят в себе элементы кнопок для выбора оплаты картой и для выбора оплаты наличными соответственно.

Конструктор:

```
constructor(container: HTMLFormElement, events: IEvents)

    Параметры:
        * container: HTMLFormElement -  HTML-форма заказа.
        *  events: IEvents - Объект, реализующий интерфейс `IEvents`, для управления событиями.

        super(container, events); // Вызов конструктора базового класса

        // Инициализация кнопок оплаты
        this._paymentCard = this.container.elements.namedItem('card') as HTMLButtonElement;
        this._paymentCash = this.container.elements.namedItem('cash') as HTMLButtonElement;

        // Обработчики событий для кнопок оплаты
        this._paymentCard.addEventListener('click', () => {
            events.emit('payment:change', { field: 'payment', value: 'card' });
        });

        this._paymentCash.addEventListener('click', () => {
            events.emit('payment:change', { field: 'payment', value: 'cash' });
        });

```

Включает сеттеры:

```
    * Устанавливает адрес доставки.
   set address(value: string): void;

    * Устанавливает способ оплаты.
   set payment(value: string): void;
```

### Contacts

- Компонент для ввода контактной информации.
- Расширяет базовый класс `Form` и принимает данные типа `IOrderForm`.

Конструктор:

```
 * Создает новый экземпляр формы контактных данных.
constructor(container: HTMLFormElement, events: IEvents)

Параметры:
     *container: HTMLFormElement - HTML-форма контактных данных.
     * events: IEvents -  Объект, реализующий интерфейс `IEvents`, для управления событиями.

     {
        super(container, events); // Вызов конструктора базового класса
    }

```

Включает сеттеры:

```
     * Устанавливает номер телефона.
    set phone(value: string): void;

     * Устанавливает адрес электронной почты.
    set email(value: string): void;

```

### Page

- Компонент для отображения страницы.
- Расширяет базовый класс `Component` и принимает данные типа `IPage`.

Свойства:

```
    * Счетчик товаров в корзине.
   protected _counter: HTMLElement;

    * Контейнер для отображения каталога товаров.
   protected _catalog: HTMLElement;

    * Обертка страницы.
   protected _wrapper: HTMLElement;

    * Контейнер для отображения корзины.
   protected _basket: HTMLElement;

```

Сеттеры:

```
* Устанавливает количество товаров в корзине.
   set counter(value: number): void;

    * Устанавливает элементы каталога товаров.
   set catalog(items: HTMLElement[]): void;

    * Устанавливает блокировку страницы.
   set locked(value: boolean): void;

```

## Компоненты презентера

### ShopAPI

- Класс для взаимодействия с API магазина.
- Расширяет базовый класс `Api` и реализует интерфейс `IShopAPI`.

Содержит свойство cdn отвечающее за базовый URL для загрузки статических ресурсов.

Включает методы:

```
    * Получает информацию о товаре по его идентификатору.
   getProductItem(id: string): Promise<IProductItem>;

    * Получает список товаров.
   getProductList(): Promise<IProductItem[]>;

    * Оформляет заказ на указанные товары.
   orderProducts(order: IOrder): Promise<IOrderResult>;

```

# Ключевые типы данных:

### IAppState

Интерфейс, описывающий структуру состояния приложения.

```
	catalog: IProductItem[]; // Массив продуктов в каталоге
    basket: string[]; // Массив идентификаторов продуктов в корзине
    preview: string | null; // Путь к предпросмотру или null, если предпросмотр отсутствует
    order: IOrder | null; // Информация о заказе или null, если заказ не создан
    loading: boolean; // Флаг загрузки данных (true - если данные загружаются, false - если загрузка завершена)

```

### IProductItem

Интерфейс, описывающий структуру элемента продукта.

```
    id: string; // Уникальный идентификатор продукта
    description?: string; // Описание продукта (необязательное поле)
    image: string; // Путь к изображению продукта
    title: string; // Название продукта
    category: string; // Категория продукта
    price: number; // Цена продукта

```

### IProductList

Интерфейс, описывающий список продуктов.

```
    total: number; // Общее количество продуктов в списке
    items: IProductItem[]; // Массив элементов продуктов

```

### IOrderForm

Интерфейс, описывающий форму заказа.

```
interface IOrderForm {
    payment: string; // Способ оплаты
    email: string; // Электронная почта
    phone: string; // Телефон
    address: string; // Адрес доставки
}
```

### IOrder

Интерфейс, описывающий заказ.

```
    total: number; // Общая сумма заказа
    items: string[]; // Массив идентификаторов товаров в заказе
```

### IOrderResult

Интерфейс, описывающий результат заказа.

```
    id: string; // Уникальный идентификатор заказа
    total: number; // Общая сумма заказа

```

### IOrderResultError

Интерфейс, описывающий ошибку при заказе.

```
   error: string; // Сообщение об ошибке при заказе
```

### ICard

Интерфейс, описывающий структуру карточки продукта. Дочерний от IProductItem

```
	 index?: string; // Индекс карточки (необязательное поле)
    buttonTitle?: string; // Заголовок кнопки (необязательное поле)
```

### IBasketView

Интерфейс, описывающий представление корзины.

```
    items: HTMLElement[]; // Массив HTML-элементов товаров в корзине
    total: number; // Общая сумма заказа
    selected: string[]; // Массив идентификаторов выбранных товаров

```

### IFormState

Интерфейс, описывающий состояние формы.

```
valid: boolean; // Флаг, указывающий на корректность данных в форме
    errors: string[]; // Массив строк с описанием ошибок в форме
```

### IPage

Интерфейс, описывающий страницу.

```
 counter: number; // Счетчик элементов на странице
    catalog: HTMLElement[]; // Массив HTML-элементов каталога
```

### IShopAPI

Интерфейс, описывающий API магазина.

```
Получение списка продуктов.
     * Возвращает Промис, который разрешается массивом элементов продуктов.
getProductList: () => Promise<IProductItem[]>;

Получение информации о продукте по его идентификатору.
     * параметр - id Идентификатор продукта.
     * возвращает Промис, который разрешается информацией о продукте.
getProductItem: (id: string) => Promise<IProductItem>;


Оформление заказа.
     *параметр - order Информация о заказе.
     * возвращает Промис, который разрешается результатом заказа.
    orderProducts: (order: IOrder) => Promise<IOrderResult>;
```

# Описание событий

#### Изменились элементы каталога

```
'items:changed'
```

#### Открытие карточки продукта

```
'card:select'
```

#### При открытии модалки

```
'modal:open'
```

#### При закрытии модалки

```
'modal:close'
```

#### Сабмит модалки с выбором оплаты и адресом

```
'order:submit'
```

#### Сабмит заказа

```
'contacts:submit'
```

#### Изменилось состояние валидации формы

```
'formErrorsContacts:change'

'formErrors:change'
```

#### Изменения в инпутах полях окна адреса и оплаты

```
/^order\..*:change/
```

#### Изменения в инпутах полях окна контакты

```
/^contacts\..*:change/
```

#### Изменение способа оплаты

```
	'payment:change',
```

#### Открыть форму заказа

```
'order:open'
```

#### Открыть корзину

```
'basket:open'
```

#### Изменения в карточке

```
'preview:changed'
```

#### Срабатывает при добавлении удалении товара в корзину

```
'product:changed'
```

#### Любое изменение в корзине

```
'basket:changed'
```
